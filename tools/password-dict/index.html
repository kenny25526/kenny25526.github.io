<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>密码字典在线生成 | kenny's blog</title><meta name="author" content="Kenny"><meta name="copyright" content="Kenny"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="f6f7f9"><meta name="description" content="强密码字典在线生成器（安全版）      仅用于自有账号密码初始化、批量改密和合规安全测试，请勿用于未授权尝试。             生成模式                    随机字符模式           短语组合模式                       生成数量                        结果去重        最小长度">
<meta property="og:type" content="website">
<meta property="og:title" content="密码字典在线生成">
<meta property="og:url" content="https://www.52jl.top/tools/password-dict/index.html">
<meta property="og:site_name" content="kenny&#39;s blog">
<meta property="og:description" content="强密码字典在线生成器（安全版）      仅用于自有账号密码初始化、批量改密和合规安全测试，请勿用于未授权尝试。             生成模式                    随机字符模式           短语组合模式                       生成数量                        结果去重        最小长度">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.52jl.top/img/avatar.jpg">
<meta property="article:published_time" content="2026-02-15T12:26:38.767Z">
<meta property="article:modified_time" content="2026-02-15T12:26:38.767Z">
<meta property="article:author" content="Kenny">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.52jl.top/img/avatar.jpg"><script type="application/ld+json"></script><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://www.52jl.top/tools/password-dict/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css?v=5.5.4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.13.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: false,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '密码字典在线生成',
  isHighlightShrink: false,
  isToc: false,
  pageType: 'page'
}</script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Noto+Sans+SC:wght@400;500;700&family=Noto+Serif+SC:wght@400;600;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="/css/custom.css?v=20260214a"><meta name="referrer" content="no-referrer">
<meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data: blob:; script-src 'self' https: 'unsafe-inline' 'unsafe-eval'; style-src 'self' https: 'unsafe-inline'; img-src 'self' https: data: blob:; font-src 'self' https: data:; connect-src 'self' https:; object-src 'none'; base-uri 'self'; form-action 'self'; upgrade-insecure-requests">
<script>
(() => {
  try {
    if (window.top !== window.self) {
      window.top.location = window.self.location.href;
      return;
    }

    const host = window.location.hostname;
    const isLocal = host === 'localhost' || host === '127.0.0.1';
    if (!isLocal && window.location.protocol === 'http:') {
      window.location.replace('https://' + window.location.host + window.location.pathname + window.location.search + window.location.hash);
    }
  } catch (e) {}
})();
</script>
</head><body><div class="bg-animation" id="web_bg" style="background-color: #f6f7f9;"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/ loading='lazy'></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">34</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-handshake"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-house-signal"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-box-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-tree"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-toolbox"></i><span> Tools</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/tools/url-extractor/"><i class="fa-fw fas fa-filter"></i><span> IP/域名/URL 提取</span></a></li><li><a class="site-page child" href="/tools/password-dict/"><i class="fa-fw fas fa-key"></i><span> 密码字典生成</span></a></li><li><a class="site-page child" href="/tools/av-detector/"><i class="fa-fw fas fa-shield-virus"></i><span> 杀软识别</span></a></li><li><a class="site-page child" href="/tools/systeminfo-risk/"><i class="fa-fw fas fa-shield-halved"></i><span> systeminfo 补丁风险分析</span></a></li><li><a class="site-page child" href="/tools/shell-command/"><i class="fa-fw fas fa-terminal"></i><span> 命令编码工具</span></a></li></ul></div></div></div></div><div class="page" id="body-wrap"><header class="not-top-img fixed" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">kenny's blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-handshake"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-house-signal"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-box-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-tree"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-toolbox"></i><span> Tools</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/tools/url-extractor/"><i class="fa-fw fas fa-filter"></i><span> IP/域名/URL 提取</span></a></li><li><a class="site-page child" href="/tools/password-dict/"><i class="fa-fw fas fa-key"></i><span> 密码字典生成</span></a></li><li><a class="site-page child" href="/tools/av-detector/"><i class="fa-fw fas fa-shield-virus"></i><span> 杀软识别</span></a></li><li><a class="site-page child" href="/tools/systeminfo-risk/"><i class="fa-fw fas fa-shield-halved"></i><span> systeminfo 补丁风险分析</span></a></li><li><a class="site-page child" href="/tools/shell-command/"><i class="fa-fw fas fa-terminal"></i><span> 命令编码工具</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><h1 class="title-seo">密码字典在线生成</h1></header><main class="layout hide-aside" id="content-inner"><div id="page"><div class="page-title">密码字典在线生成</div><div class="container" id="article-container">
<div class="pwd-tool">
  <div class="pwd-shell">
    <h2 class="pwd-title">强密码字典在线生成器（安全版）</h2>

    <div class="pwd-safe-banner">仅用于自有账号密码初始化、批量改密和合规安全测试，请勿用于未授权尝试。</div>

    <div class="pwd-grid pwd-grid-3">
      <label class="pwd-item">生成模式
        <select id="pwd-mode">
          <option value="random" selected>随机字符模式</option>
          <option value="passphrase">短语组合模式</option>
        </select>
      </label>
      <label class="pwd-item">生成数量
        <input type="number" id="pwd-qty" min="1" max="100000" value="5000">
      </label>
      <label class="pwd-item"><input type="checkbox" id="pwd-dedup" checked> 结果去重</label>

      <label class="pwd-item">最小长度
        <input type="number" id="pwd-min-length" min="1" max="128" value="12">
      </label>
      <label class="pwd-item">最大长度
        <input type="number" id="pwd-max-length" min="1" max="128" value="20">
      </label>
      <label class="pwd-item"><input type="checkbox" id="pwd-sort"> 结果排序</label>

      <label class="pwd-item">统一前缀
        <input type="text" id="pwd-prefix" placeholder="如：Corp-">
      </label>
      <label class="pwd-item">统一后缀
        <input type="text" id="pwd-suffix" placeholder="如：!2026">
      </label>
      <label class="pwd-item"><input type="checkbox" id="pwd-unique"> 随机模式：单条内字符不重复</label>
    </div>

    <div class="pwd-panels">
      <section class="pwd-panel" id="pwd-random-panel">
        <h3>随机字符配置</h3>
        <div class="pwd-grid pwd-grid-3">
          <label class="pwd-item"><input type="checkbox" id="pwd-num" checked> 启用数字</label>
          <label class="pwd-item"><input type="checkbox" id="pwd-lower" checked> 启用小写字母</label>
          <label class="pwd-item"><input type="checkbox" id="pwd-upper" checked> 启用大写字母</label>

          <label class="pwd-item"><input type="checkbox" id="pwd-special-on" checked> 启用特殊符号</label>
          <label class="pwd-item"><input type="checkbox" id="pwd-ambiguous"> 排除易混淆字符（iIlL1oO0）</label>
          <label class="pwd-item">排除字符
            <input type="text" id="pwd-exclude" placeholder="如：{}[]/\\">
          </label>

          <label class="pwd-item pwd-span-2">特殊符号集
            <input type="text" id="pwd-special" value="!@#$%^&*()_+-=,./?~">
          </label>
          <label class="pwd-item">自定义字符集
            <input type="text" id="pwd-custom" placeholder="额外字符，如：abcXYZ">
          </label>
        </div>
      </section>

      <section class="pwd-panel" id="pwd-phrase-panel" hidden>
        <h3>短语组合配置</h3>
        <div class="pwd-grid pwd-grid-3">
          <label class="pwd-item">大小写策略
            <select id="pwd-case-policy">
              <option value="keep" selected>保持原样</option>
              <option value="lower">全部小写</option>
              <option value="upper">全部大写</option>
              <option value="capitalize">首字母大写</option>
              <option value="random">随机大小写</option>
            </select>
          </label>
          <label class="pwd-item">连接符候选（逗号分隔）
            <input type="text" id="pwd-separators" value="-,_,.">
          </label>
          <label class="pwd-item">模板（每行一个）
            <input type="text" id="pwd-pattern-inline" value="{A}{SEP}{N}{S}">
          </label>
        </div>

        <div class="pwd-list-grid">
          <div>
            <label class="pwd-list-label" for="pwd-phrase-a">词库 A（每行一个）</label>
            <textarea class="pwd-list" id="pwd-phrase-a" rows="6">BlueRiver
NorthWind
SilverLine
CloudNest
IronGate</textarea>
          </div>
          <div>
            <label class="pwd-list-label" for="pwd-phrase-b">词库 B（每行一个）</label>
            <textarea class="pwd-list" id="pwd-phrase-b" rows="6">Secure
Access
Ops
Vault
Core</textarea>
          </div>
          <div>
            <label class="pwd-list-label" for="pwd-phrase-n">数字片段（每行一个）</label>
            <textarea class="pwd-list" id="pwd-phrase-n" rows="6">2026
2027
123
520
8888</textarea>
          </div>
          <div>
            <label class="pwd-list-label" for="pwd-phrase-s">符号片段（每行一个）</label>
            <textarea class="pwd-list" id="pwd-phrase-s" rows="6">!
@
#
$
_</textarea>
          </div>
        </div>

        <label class="pwd-list-label" for="pwd-patterns">模板列表（每行一个，支持占位符 {A} {B} {N} {S} {SEP}）</label>
        <textarea class="pwd-list" id="pwd-patterns" rows="4">{A}{SEP}{N}{S}
{A}{B}{N}{S}
{A}{SEP}{B}{SEP}{N}</textarea>
      </section>

      <section class="pwd-panel">
        <h3>强度过滤</h3>
        <div class="pwd-grid pwd-grid-4">
          <label class="pwd-item">最少数字
            <input type="number" id="pwd-min-num" min="0" max="64" value="1">
          </label>
          <label class="pwd-item">最少小写
            <input type="number" id="pwd-min-lower" min="0" max="64" value="1">
          </label>
          <label class="pwd-item">最少大写
            <input type="number" id="pwd-min-upper" min="0" max="64" value="1">
          </label>
          <label class="pwd-item">最少符号
            <input type="number" id="pwd-min-special" min="0" max="64" value="1">
          </label>
        </div>
        <div class="pwd-grid pwd-grid-2">
          <label class="pwd-item"><input type="checkbox" id="pwd-no-pure-num" checked> 过滤纯数字密码</label>
          <label class="pwd-item"><input type="checkbox" id="pwd-no-pure-alpha" checked> 过滤纯字母密码</label>
        </div>
      </section>
    </div>

    <div class="pwd-row">
      <button class="pwd-btn" id="pwd-generate">生成字典</button>
      <button class="pwd-btn alt" id="pwd-copy">复制结果</button>
      <button class="pwd-btn alt" id="pwd-download-txt">下载 txt</button>
      <button class="pwd-btn alt" id="pwd-download-csv">下载 csv</button>
      <button class="pwd-btn warn" id="pwd-clear">清空</button>
    </div>

    <div class="pwd-meta">
      <span>当前结果：<b id="pwd-count">0</b> 条</span>
      <span>字符池/组合量：<b id="pwd-pool-size">0</b></span>
      <span>估算强度：<b id="pwd-strength">0 bits</b></span>
    </div>

    <textarea id="pwd-output" rows="16" readonly placeholder="点击“生成字典”后显示结果"></textarea>
    <div class="pwd-note" id="pwd-status">提示：配置会自动保存到浏览器本地存储。此版本仅用于防御侧密码治理与初始化。</div>
  </div>
</div>

<script>
(() => {
  const $ = (s) => document.querySelector(s);
  const els = {
    mode: $("#pwd-mode"),
    qty: $("#pwd-qty"),
    dedup: $("#pwd-dedup"),
    minLen: $("#pwd-min-length"),
    maxLen: $("#pwd-max-length"),
    sort: $("#pwd-sort"),
    prefix: $("#pwd-prefix"),
    suffix: $("#pwd-suffix"),
    unique: $("#pwd-unique"),

    num: $("#pwd-num"),
    lower: $("#pwd-lower"),
    upper: $("#pwd-upper"),
    specialOn: $("#pwd-special-on"),
    special: $("#pwd-special"),
    custom: $("#pwd-custom"),
    exclude: $("#pwd-exclude"),
    ambiguous: $("#pwd-ambiguous"),

    casePolicy: $("#pwd-case-policy"),
    separators: $("#pwd-separators"),
    patternInline: $("#pwd-pattern-inline"),
    phraseA: $("#pwd-phrase-a"),
    phraseB: $("#pwd-phrase-b"),
    phraseN: $("#pwd-phrase-n"),
    phraseS: $("#pwd-phrase-s"),
    patterns: $("#pwd-patterns"),

    minNum: $("#pwd-min-num"),
    minLower: $("#pwd-min-lower"),
    minUpper: $("#pwd-min-upper"),
    minSpecial: $("#pwd-min-special"),
    noPureNum: $("#pwd-no-pure-num"),
    noPureAlpha: $("#pwd-no-pure-alpha"),

    panelRandom: $("#pwd-random-panel"),
    panelPhrase: $("#pwd-phrase-panel"),

    output: $("#pwd-output"),
    count: $("#pwd-count"),
    poolSize: $("#pwd-pool-size"),
    strength: $("#pwd-strength"),
    status: $("#pwd-status"),

    btnGen: $("#pwd-generate"),
    btnCopy: $("#pwd-copy"),
    btnDlTxt: $("#pwd-download-txt"),
    btnDlCsv: $("#pwd-download-csv"),
    btnClear: $("#pwd-clear")
  };

  const storeKey = "pwd_dict_config_v2_safe";
  const ambiguousChars = "iIlL1oO0";

  const clamp = (n, min, max) => Math.max(min, Math.min(max, n));
  const toInt = (value, fallback) => {
    const n = Number(value);
    return Number.isFinite(n) ? Math.trunc(n) : fallback;
  };

  const randomInt = (max) => {
    if (max <= 1) return 0;
    if (window.crypto && window.crypto.getRandomValues) {
      const maxUint = 0xffffffff;
      const limit = Math.floor(maxUint / max) * max;
      const arr = new Uint32Array(1);
      do {
        window.crypto.getRandomValues(arr);
      } while (arr[0] >= limit);
      return arr[0] % max;
    }
    return Math.floor(Math.random() * max);
  };

  const pickOne = (arr) => arr[randomInt(arr.length)];
  const uniqChars = (text) => [...new Set((text || "").split(""))].join("");

  const parseList = (value) => (value || "")
    .split(/[\r\n,，;；]+/)
    .map((v) => v.trim())
    .filter(Boolean);

  const parseLines = (value) => (value || "")
    .split(/\r?\n/)
    .map((v) => v.trim())
    .filter(Boolean);

  const removeChars = (source, chars) => {
    if (!chars) return source;
    const blocked = new Set(chars.split(""));
    return source.split("").filter((ch) => !blocked.has(ch)).join("");
  };

  const setStatus = (msg) => {
    els.status.textContent = msg;
  };

  const formatBigInt = (value) => {
    if (value <= 0n) return "0";
    const text = value.toString();
    if (text.length <= 12) return text;
    return `${text.slice(0, 4)}.${text.slice(4, 8)}e+${text.length - 1}`;
  };

  const getAllConfigTargets = () => [
    els.mode, els.qty, els.dedup, els.minLen, els.maxLen, els.sort, els.prefix, els.suffix, els.unique,
    els.num, els.lower, els.upper, els.specialOn, els.special, els.custom, els.exclude, els.ambiguous,
    els.casePolicy, els.separators, els.patternInline, els.phraseA, els.phraseB, els.phraseN, els.phraseS, els.patterns,
    els.minNum, els.minLower, els.minUpper, els.minSpecial, els.noPureNum, els.noPureAlpha
  ];

  const saveConfig = () => {
    const cfg = {};
    getAllConfigTargets().forEach((el) => {
      cfg[el.id] = el.type === "checkbox" ? el.checked : el.value;
    });
    localStorage.setItem(storeKey, JSON.stringify(cfg));
  };

  const loadConfig = () => {
    const raw = localStorage.getItem(storeKey);
    if (!raw) return;
    try {
      const cfg = JSON.parse(raw);
      getAllConfigTargets().forEach((el) => {
        if (!(el.id in cfg)) return;
        if (el.type === "checkbox") {
          el.checked = !!cfg[el.id];
        } else {
          el.value = cfg[el.id];
        }
      });
    } catch {
      // ignore broken config
    }
  };

  const countTypes = (text) => {
    let num = 0;
    let lower = 0;
    let upper = 0;
    let special = 0;
    for (const ch of text) {
      if (ch >= "0" && ch <= "9") {
        num++;
      } else if (ch >= "a" && ch <= "z") {
        lower++;
      } else if (ch >= "A" && ch <= "Z") {
        upper++;
      } else {
        special++;
      }
    }
    return { num, lower, upper, special };
  };

  const buildRandomPool = () => {
    let pool = "";
    if (els.num.checked) pool += "0123456789";
    if (els.lower.checked) pool += "abcdefghijklmnopqrstuvwxyz";
    if (els.upper.checked) pool += "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    if (els.specialOn.checked) pool += els.special.value || "";
    if (els.custom.value) pool += els.custom.value;

    pool = uniqChars(pool);
    if (els.ambiguous.checked) pool = removeChars(pool, ambiguousChars);
    if (els.exclude.value) pool = removeChars(pool, els.exclude.value);

    return uniqChars(pool);
  };

  const getEffectiveBaseLengthRange = () => {
    const minLen = clamp(toInt(els.minLen.value, 12), 1, 128);
    const maxLen = clamp(toInt(els.maxLen.value, 20), minLen, 128);
    const affixLen = (els.prefix.value || "").length + (els.suffix.value || "").length;
    const baseMin = Math.max(0, minLen - affixLen);
    const baseMax = Math.max(0, maxLen - affixLen);
    return { minLen, maxLen, baseMin, baseMax };
  };

  const estimateRandomSpace = (poolSize, minBaseLen, maxBaseLen) => {
    if (poolSize <= 0 || maxBaseLen < minBaseLen) return { total: 0n, minBits: 0 };
    let total = 0n;
    const bPool = BigInt(poolSize);
    for (let len = minBaseLen; len <= maxBaseLen; len++) {
      total += bPool ** BigInt(len);
    }
    const minBits = poolSize > 1 ? Math.log2(poolSize) * minBaseLen : 0;
    return { total, minBits };
  };

  const estimatePhraseSpace = (cfg) => {
    const tokenSize = {
      A: cfg.listA.length || 1,
      B: cfg.listB.length || (cfg.listA.length || 1),
      N: cfg.listN.length || 1,
      S: cfg.listS.length || 1,
      SEP: cfg.seps.length || 1
    };

    let total = 0n;
    cfg.patterns.forEach((pattern) => {
      let ways = 1n;
      const tokens = pattern.match(/\{(A|B|N|S|SEP)\}/g) || [];
      tokens.forEach((token) => {
        const key = token.slice(1, -1);
        ways *= BigInt(tokenSize[key]);
      });
      total += ways;
    });
    return total;
  };

  const updateModeVisibility = () => {
    const isRandom = els.mode.value === "random";
    els.panelRandom.hidden = !isRandom;
    els.panelPhrase.hidden = isRandom;
  };

  const updateStats = () => {
    const { baseMin, baseMax } = getEffectiveBaseLengthRange();
    if (els.mode.value === "random") {
      const pool = buildRandomPool();
      els.poolSize.textContent = String(pool.length);
      const estimation = estimateRandomSpace(pool.length, baseMin, baseMax);
      els.strength.textContent = `${Math.max(0, estimation.minBits).toFixed(1)} bits`;
      if (pool.length === 0) {
        setStatus("字符池为空，请至少启用一种字符类别或填写自定义字符集。");
      } else if (baseMin > baseMax) {
        setStatus("长度区间与前后缀冲突：请增大最大长度或缩短前后缀。");
      } else {
        setStatus(`随机模式组合空间约 ${formatBigInt(estimation.total)}。`);
      }
      return;
    }

    const phraseCfg = buildPhraseCfg();
    const total = estimatePhraseSpace(phraseCfg);
    els.poolSize.textContent = formatBigInt(total);
    els.strength.textContent = "按模板组合";
    setStatus(`短语模式模板组合空间约 ${formatBigInt(total)}。`);
  };

  const applyCase = (text, policy) => {
    if (policy === "lower") return text.toLowerCase();
    if (policy === "upper") return text.toUpperCase();
    if (policy === "capitalize") {
      return text.toLowerCase().replace(/\b[a-z]/g, (m) => m.toUpperCase());
    }
    if (policy === "random") {
      return text.split("").map((ch) => {
        if (!/[a-z]/i.test(ch)) return ch;
        return randomInt(2) === 0 ? ch.toLowerCase() : ch.toUpperCase();
      }).join("");
    }
    return text;
  };

  const generateRandomBase = (pool, len, unique) => {
    if (len <= 0) return "";
    if (!pool.length) return "";

    const chars = pool.split("");
    let out = "";
    const takeLen = unique ? Math.min(len, chars.length) : len;

    for (let i = 0; i < takeLen; i++) {
      const idx = randomInt(chars.length);
      out += chars[idx];
      if (unique) chars.splice(idx, 1);
    }

    return out;
  };

  const buildPhraseCfg = () => {
    const patterns = parseLines(els.patterns.value);
    const inline = (els.patternInline.value || "").trim();
    if (inline && !patterns.includes(inline)) patterns.unshift(inline);

    return {
      listA: parseList(els.phraseA.value),
      listB: parseList(els.phraseB.value),
      listN: parseList(els.phraseN.value),
      listS: parseList(els.phraseS.value),
      seps: parseList(els.separators.value),
      patterns: patterns.length ? patterns : ["{A}{SEP}{N}{S}"],
      casePolicy: els.casePolicy.value
    };
  };

  const generatePhraseBase = (cfg) => {
    const listA = cfg.listA.length ? cfg.listA : ["Secure"];
    const listB = cfg.listB.length ? cfg.listB : listA;
    const listN = cfg.listN.length ? cfg.listN : [String(new Date().getFullYear())];
    const listS = cfg.listS.length ? cfg.listS : ["!"];
    const seps = cfg.seps.length ? cfg.seps : ["-"];

    const map = {
      A: () => pickOne(listA),
      B: () => pickOne(listB),
      N: () => pickOne(listN),
      S: () => pickOne(listS),
      SEP: () => pickOne(seps)
    };

    const pattern = pickOne(cfg.patterns);
    const merged = pattern.replace(/\{(A|B|N|S|SEP)\}/g, (_, token) => map[token]());
    return applyCase(merged, cfg.casePolicy);
  };

  const validateCandidate = (text) => {
    const minLen = clamp(toInt(els.minLen.value, 12), 1, 128);
    const maxLen = clamp(toInt(els.maxLen.value, 20), minLen, 128);
    if (text.length < minLen || text.length > maxLen) return false;

    if (els.noPureNum.checked && /^\d+$/.test(text)) return false;
    if (els.noPureAlpha.checked && /^[A-Za-z]+$/.test(text)) return false;

    const minNum = clamp(toInt(els.minNum.value, 1), 0, 64);
    const minLower = clamp(toInt(els.minLower.value, 1), 0, 64);
    const minUpper = clamp(toInt(els.minUpper.value, 1), 0, 64);
    const minSpecial = clamp(toInt(els.minSpecial.value, 1), 0, 64);

    const count = countTypes(text);
    return count.num >= minNum
      && count.lower >= minLower
      && count.upper >= minUpper
      && count.special >= minSpecial;
  };

  const normalizeGeneralInputs = () => {
    els.qty.value = String(clamp(toInt(els.qty.value, 5000), 1, 100000));
    els.minLen.value = String(clamp(toInt(els.minLen.value, 12), 1, 128));
    els.maxLen.value = String(clamp(toInt(els.maxLen.value, 20), Number(els.minLen.value), 128));

    [els.minNum, els.minLower, els.minUpper, els.minSpecial].forEach((el) => {
      el.value = String(clamp(toInt(el.value, 1), 0, 64));
    });
  };

  const generateBatch = () => {
    normalizeGeneralInputs();

    const qty = clamp(toInt(els.qty.value, 5000), 1, 100000);
    const dedup = els.dedup.checked;
    const sort = els.sort.checked;
    const prefix = els.prefix.value || "";
    const suffix = els.suffix.value || "";

    const { baseMin, baseMax } = getEffectiveBaseLengthRange();
    if (baseMin > baseMax) {
      els.output.value = "";
      els.count.textContent = "0";
      setStatus("生成失败：前后缀过长导致长度区间无可用空间。请调整长度或前后缀。");
      return;
    }

    const result = [];
    const seen = new Set();

    let pool = "";
    if (els.mode.value === "random") {
      pool = buildRandomPool();
      if (!pool.length) {
        els.output.value = "";
        els.count.textContent = "0";
        setStatus("生成失败：字符池为空，请至少启用一种字符类别。");
        return;
      }
    }

    const phraseCfg = els.mode.value === "passphrase" ? buildPhraseCfg() : null;
    const guardMax = qty * 120;
    let guard = 0;

    while (result.length < qty && guard < guardMax) {
      let base = "";
      if (els.mode.value === "random") {
        const targetLen = baseMin === baseMax ? baseMin : (baseMin + randomInt(baseMax - baseMin + 1));
        if (els.unique.checked && targetLen > pool.length) {
          guard++;
          continue;
        }
        base = generateRandomBase(pool, targetLen, els.unique.checked);
      } else {
        base = generatePhraseBase(phraseCfg);
      }

      const candidate = `${prefix}${base}${suffix}`;
      if (!validateCandidate(candidate)) {
        guard++;
        continue;
      }

      if (!dedup || !seen.has(candidate)) {
        result.push(candidate);
        seen.add(candidate);
      }

      guard++;
    }

    if (sort) result.sort((a, b) => a.localeCompare(b));

    els.output.value = result.join("\n");
    els.count.textContent = String(result.length);
    saveConfig();
    updateStats();

    if (result.length < qty) {
      setStatus(`仅生成 ${result.length}/${qty} 条，可能是过滤条件较严或组合空间不足。`);
    } else {
      setStatus(`已生成 ${result.length} 条强密码候选。`);
    }
  };

  const copyOutput = async () => {
    const text = els.output.value.trim();
    if (!text) {
      setStatus("复制失败：当前没有结果。");
      return;
    }
    try {
      await navigator.clipboard.writeText(text);
      setStatus(`已复制 ${text.split(/\r?\n/).filter(Boolean).length} 条结果。`);
    } catch {
      els.output.select();
      document.execCommand("copy");
      setStatus("已复制结果。");
    }
  };

  const makeStamp = () => {
    const now = new Date();
    return `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, "0")}${String(now.getDate()).padStart(2, "0")}-${String(now.getHours()).padStart(2, "0")}${String(now.getMinutes()).padStart(2, "0")}${String(now.getSeconds()).padStart(2, "0")}`;
  };

  const download = (filename, content, mime) => {
    const blob = new Blob([content], { type: mime });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  };

  const downloadTxt = () => {
    const text = els.output.value.trim();
    if (!text) {
      setStatus("下载失败：当前没有结果。");
      return;
    }
    const file = `password-dict-safe-${makeStamp()}.txt`;
    download(file, text + "\n", "text/plain;charset=utf-8");
    setStatus("已下载 TXT 文件。");
  };

  const escapeCsv = (value) => {
    const needsQuote = /[",\r\n]/.test(value);
    const escaped = value.replace(/"/g, '""');
    return needsQuote ? `"${escaped}"` : escaped;
  };

  const downloadCsv = () => {
    const lines = els.output.value.split(/\r?\n/).map((s) => s.trim()).filter(Boolean);
    if (!lines.length) {
      setStatus("下载失败：当前没有结果。");
      return;
    }
    const rows = ["index,password"]; 
    lines.forEach((line, idx) => rows.push(`${idx + 1},${escapeCsv(line)}`));
    const file = `password-dict-safe-${makeStamp()}.csv`;
    download(file, rows.join("\n") + "\n", "text/csv;charset=utf-8");
    setStatus("已下载 CSV 文件。");
  };

  const clearResult = () => {
    els.output.value = "";
    els.count.textContent = "0";
    setStatus("已清空结果。配置项已保留。");
  };

  const onConfigChange = () => {
    normalizeGeneralInputs();
    updateModeVisibility();
    updateStats();
    saveConfig();
  };

  getAllConfigTargets().forEach((el) => {
    const eventName = el.tagName === "TEXTAREA" || el.type === "text" ? "input" : "change";
    el.addEventListener(eventName, onConfigChange);
  });

  els.btnGen.addEventListener("click", generateBatch);
  els.btnCopy.addEventListener("click", copyOutput);
  els.btnDlTxt.addEventListener("click", downloadTxt);
  els.btnDlCsv.addEventListener("click", downloadCsv);
  els.btnClear.addEventListener("click", clearResult);

  loadConfig();
  normalizeGeneralInputs();
  updateModeVisibility();
  updateStats();
})();
</script>

</div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By Kenny</span></div><div class="footer_custom_text"><div class="footer-links"><a class="footer-link" href="https://qm.qq.com/q/QNgesnj1aU" target="_blank" rel="noopener noreferrer">QQ群：点击加群</a></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"></div><div id="rightside-config-show"><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.4"></script><script src="/js/main.js?v=5.5.4"></script><div class="js-pjax"></div><script>
(() => {
  const imageSelectors = "#article-container img, #recent-posts img, .article-sort-item-img img";
  const addFallback = (img) => {
    if (!img || img.dataset.ipFallbackBound === "1") return;
    img.dataset.ipFallbackBound = "1";
    img.addEventListener("error", () => {
      const original = img.getAttribute("src") || "";
      if (!original) return;
      if (img.dataset.ipFallbackDone === "1") return;
      img.dataset.ipFallbackDone = "1";
      if (/\.webp(\?.*)?$/i.test(original)) {
        img.onerror = () => {
          img.onerror = null;
          img.src = original.replace(/\.webp(\?.*)?$/i, ".jpg$1");
          img.onerror = () => {
            img.onerror = null;
            img.src = "/img/404.jpg";
          };
        };
        img.src = original.replace(/\.webp(\?.*)?$/i, ".png$1");
        return;
      }
      img.onerror = null;
      img.src = "/img/404.jpg";
    });
  };
  const bindAll = () => document.querySelectorAll(imageSelectors).forEach(addFallback);
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", bindAll);
  } else {
    bindAll();
  }
  document.addEventListener("pjax:complete", bindAll);
})();
</script>
</div></body></html>